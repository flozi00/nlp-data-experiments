import datasets
from tqdm import tqdm
from TOKENS import BOT, PROMPTER, END


def process_3_part_ds(
    first,
    second,
    output,
    data,
) -> tuple[list, list]:
    ds = []
    label = []
    for row in tqdm(data, desc="dolly"):
        ds.append(f"{PROMPTER}{row[first]}\n{row[second]}{END}{BOT}{row[output]}{END}")
        label.append(row["category"])

    return ds, label


def dolly() -> tuple[list, list, list]:
    all_rows = []
    from_ds = []
    """
    databricks-dolly-15k is an open source dataset of instruction-following records generated by thousands of Databricks employees
    in several of the behavioral categories outlined in the InstructGPT paper, including
    brainstorming, classification, closed QA, generation, information extraction, open QA, and summarization.
    """
    ds = datasets.load_dataset(
        "argilla/databricks-dolly-15k-curated-multilingual", split="de"
    )
    ds_processed, labels = process_3_part_ds(
        "context",
        "instruction",
        "response",
        ds,
    )
    all_rows.extend(ds_processed)
    from_ds.extend(
        ["argilla/databricks-dolly-15k-curated-multilingual"] * len(ds_processed)
    )

    return all_rows, from_ds, labels
