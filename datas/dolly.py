from utils.processor import process_3_part_ds
import datasets
from TOKENS import BOT, PROMPTER, END, SYSTEM


def dolly():
    all_rows = []
    all_labels = []
    from_ds = []
    """
    databricks-dolly-15k is an open source dataset of instruction-following records generated by thousands of Databricks employees
    in several of the behavioral categories outlined in the InstructGPT paper, including
    brainstorming, classification, closed QA, generation, information extraction, open QA, and summarization.
    """
    ds = datasets.load_dataset(
        "argilla/databricks-dolly-15k-curated-multilingual", split="de"
    )
    ds_processed, labels_processed = process_3_part_ds(
        "context",
        "instruction",
        "response",
        ds,
    )
    all_rows.extend(ds_processed)
    all_labels.extend(labels_processed)
    from_ds.extend(
        ["argilla/databricks-dolly-15k-curated-multilingual"] * len(ds_processed)
    )

    labels = ds.unique("category")
    for row in ds:
        prompt = f"""{SYSTEM}Klassifiziere die folgende Anweisung als eine der folgenden Kategorien: {", ".join(labels)}{END} 
{PROMPTER}{row["context"]}\n{row["instruction"]}{END}{BOT}{row["category"]}{END}"""
        all_rows.append(prompt)
        all_labels.append("classification")
        from_ds.append("argilla/databricks-dolly-15k-curated-multilingual")

    return all_rows, all_labels, from_ds
